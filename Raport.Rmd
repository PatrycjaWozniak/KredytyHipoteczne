---
title: "Kredyty Hipoteczne"
author: 
  - "Patrycja Woźniak"
  - "Julia Zimmer"
  - "Aleksandra Sieliwoniuk"
output: pdf_document
---

### Kredyty Hipoteczne

Celem niniejszego projektu jest analiza danych związanych z udzielaniem kredytów hipotecznych, aby zidentyfikować kluczowe czynniki wpływające na decyzję o przyznaniu kredytu. Dzięki zastosowaniu narzędzi do analizy danych w języku R, przeanalizujemy, jakie cechy wnioskodawców i ich sytuacja finansowa mają największy wpływ na otrzymanie decyzji pozytywnej. W ramach analizy wykorzystamy zbiór danych zawierający różnorodne informacje o wnioskodawcach, w tym ich: płeć, stan cywilny, liczba osób na utrzymaniu, wykształcenie, zatrudnienie na własny rachunek, dochód głównego wnioskodawcy, dochód współwnioskodawcy, kwotę wnioskowanego kredytu, okres spłaty kredytu, historie kredytową oraz miejsce zamieszkania.

Załadowanie potrzebnych bibliotek

```{r}
library(naniar)
library(dplyr)
library(VIM)
library(ggplot2)
library(gtsummary)
library(summarytools)
```

### Wprowadzenie danych

```{r}
dane <- read.csv("Hipoteczny.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)
```

Zmiana pustych wartości na NA w celu poprawy jakości analizy danych, ponieważ niektóre wartości w zbiorze danych są puste (np. " ") i nie zostały oznaczone jako NA

```{r}
dane <- dane %>%
  mutate(Gender = ifelse(Gender == "" | Gender == "NULL" | Gender == "N/A", NA, Gender)) %>%
  mutate(Married = ifelse(Married == "" | Married == "NULL" | Married == "N/A", NA, Married)) %>%
  mutate(Dependents = ifelse(Dependents == "" | Dependents == "NULL" | Dependents == "N/A", NA, Dependents)) %>%
  mutate(Education = ifelse(Education == "" | Education == "NULL" | Education == "N/A", NA, Education)) %>%
  mutate(Self_Employed = ifelse(Self_Employed == "" | Self_Employed == "NULL" | Self_Employed == "N/A", NA, Self_Employed)) %>%
  mutate(ApplicantIncome = ifelse(ApplicantIncome == "" | ApplicantIncome == "NULL" | ApplicantIncome == "N/A", NA, ApplicantIncome)) %>%
  mutate(CoapplicantIncome = ifelse(CoapplicantIncome == "" | CoapplicantIncome == "NULL" | CoapplicantIncome == "N/A", NA, CoapplicantIncome)) %>%
  mutate(LoanAmount = ifelse(LoanAmount == "" | LoanAmount == "NULL" | LoanAmount == "N/A", NA, LoanAmount)) %>%
  mutate(Loan_Amount_Term = ifelse(Loan_Amount_Term == "" | Loan_Amount_Term == "NULL" | Loan_Amount_Term == "N/A", NA, Loan_Amount_Term)) %>%
  mutate(Credit_History = ifelse(Credit_History == "" | Credit_History == "NULL" | Credit_History == "N/A", NA, Credit_History)) %>%
  mutate(Property_Area = ifelse(Property_Area== "" | Property_Area == "NULL" | Property_Area == "N/A", NA, Property_Area))
```

### Utworzenie tabeli podsumowującej braki w tabeli

```{r}
miss_var_summary(dane)

```

Braki zauważamy w takich kategoriach jak: Credit_History, Self_Employed, Gender, Dependents, Loan_Amount_Term, LoanAmount. Zatem badamy brakujące dane wg poszczególnych kategorii.

```{r}
dane %>%
  group_by(Credit_History) %>%
    miss_var_summary() %>%
    print(n=33)

```

```{r}
gg_miss_var(dane, facet = Credit_History)
```

Braki w danych głównie są dla osób, które miały kredyt, w kategoriach takich jak Self_Employed, Gender, Dependents. Braki dla osób, które nie miały kredytu są głównie w kategorii Self_Employed.

```{r}

dane %>%
  group_by(Self_Employed) %>%
    miss_var_summary() %>%
    print(n=33)
```

```{r}
gg_miss_fct(dane, fct = Self_Employed)
```

Braki danych głównie są dla osób które nie są samozatrudnione, głównie w kategorii Credit_History (8.47%), Gender (2.93%), Dependents (2.93%). Osoby, które są samozatrudnione mają małe braki danych w kategoriach Gender (5.41%) i Credit_history (5.41%).

```{r}
 dane %>%
  group_by(Gender) %>%
    miss_var_summary() %>%
    print(n=33)
```

```{r}
gg_miss_var(dane, facet = Gender)
```

Nie ma znaczącego rozróznicowania braków ze względu na kategorie ze względu na płeć. Widać jednakże, że więcej braków jest u mężczyzn.

```{r}
dane %>%
  group_by(Dependents) %>%
    miss_var_summary() %>%
    print(n=22)
```

```{r}
gg_miss_var(dane, facet = Dependents)
```

Bez względu na ilość osób na utrzymaniu, braki są w takich kategoriach jak: Credit_History, Self_Employed. Najmniej rozróżnicowania braków w kategoriach jest dla osób mających 2 osoby na utrzymaniu.

```{r}
dane %>%
  group_by(Loan_Amount_Term) %>%
    miss_var_summary() %>%
    print(n=10)
```

```{r}

gg_miss_var(dane, facet = Loan_Amount_Term)

```

Znaczące braki mają osoby, które mają kredyty na okres roku.

### Wizualizacja braków danych

```{r}
dane %>%
  miss_case_table()
```

W 289 wierszach nie brakuje żadnych danych, co stanowi 78.74 % wszystykich wierszy. W 72 wierszach brakuje 1 danej, co stanowi 19.61% wszystkich wierszy. W 6 wierszach brakuje równocześnie 2 danych, co stanowi 1.63% wszystkich wierszy.

```{r}
vis_miss(dane)
```

Ogólnie braki stanowią 1.9% wszystkich danych.

### Wizualizacja jak często braki współwystępują między zmiennymi

```{r}
gg_miss_upset(dane, nsets = 6)

```

Podsumowując braki danych dotyczą głównie kategorii takich jak: Credit_History, Self_Employed, Gender, Dependents, Loan_Amount_Term oraz LoanAmount. Najwięcej braków występuje u osób, które miały historię kredytową, szczególnie w kategoriach Self_Employed i Gender. Wśród osób niesamozatrudnionych braki są bardziej widoczne w Credit_History (8.47%), Gender (2.93%) i Dependents (2.93%). Samozatrudnieni mają mniej braków, ale widoczne są one w Credit_History (5.41%) i Gender (5.41%). Więcej braków danych występuje u mężczyzn, jednak różnice między płciami nie są znaczące. W kategorii Dependents braki dotyczą głównie osób mających 0 lub 1 osobę na utrzymaniu, a najmniej braków obserwuje się u osób z 2 osobami na utrzymaniu. Największe luki w danych Loan_Amount_Term występują u osób z kredytami na okres jednego roku.

Braki te mogą wpłynąć na wyniki analizy, dlatego w kolejnym kroku uzupełnimy braki danych metodą hot deck imputation, która polega na uzupełnianiu braków danych poprzez przypisanie brakującej wartości na podstawie istniejących danych od podobnych obserwacji w zbiorze danych.Następnie sprawdzamy czy wszystkie braki zostały uzupełnione.

```{r}
data <-hotdeck(dane)
miss_var_summary(data)
```

### Analiza danych odstających za pomocą histogramu.

```{r}
hist(
  data$LoanAmount,
  main = "Histogram wartości LoanAmount",
  xlab = "Kwota pożyczki",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 # Możesz dostosować liczbę przedziałów
)

```

```{r}

hist(
  data$ApplicantIncome,
  main = "Histogram dla ApplicantIncome",
  xlab = "Dochód wnioskodawcy",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)
```

```{r}
boxplot(
  data$ApplicantIncome,
  main = "Wykres pudełkowy dla ApplicantIncome",
  ylab = "Dochód wnioskodawcy",
  col = "lightgreen",
  border = "black"
)
```

```{r}

hist(
  data$CoapplicantIncome,
  main = "Histogram dla CoapplicantIncome",
  xlab = "Dochód współwnioskodawcy",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)
```

```{r}
boxplot(
  data$CoapplicantIncome,
  main = "Wykres pudełkowy dla CoapplicantIncome",
  ylab = "Dochód współwnioskodawcy",
  col = "lightpink",
  border = "black"
)

```

```{r}
hist(
  data$LoanAmount,
  main = "Histogram dla LoanAmount",
  xlab = "Kwota pożyczki",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)
```

```{r}
boxplot(
  data$LoanAmount,
  main = "Wykres pudełkowy dla LoanAmount",
  ylab = "Kwota pożyczki",
  col = "lightblue",
  border = "black"
)
```

```{r}

hist(
  data$Loan_Amount_Term,
  main = "Histogram dla Loan_Amount_Term",
  xlab = "Termin kwoty pożyczki",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)
```

Histogram pokazuje rozkład terminów pożyczek i potwierdza, że zdecydowana większość przypadków przypada na jeden dominujący okres, prawdopodobnie 360 miesięcy.

Widoczne są również inne rzadsze wartości, ale ich liczebność jest stosunkowo niska. Oznacza to, że w zbiorze danych występują różne okresy pożyczek, ale jeden (najdłuższy) jest zdecydowanie najczęściej wybierany przez klientów. Histogram pomaga lepiej zrozumieć rozkład wartości w porównaniu do boxplota, zwłaszcza w zakresie liczby obserwacji dla każdej grupy.

```{r}
boxplot(
  data$Loan_Amount_Term,
  main = "Wykres pudełkowy dla Loan_Amount_Term",
  ylab = "Termin pożyczki",
  col = "pink",
  border = "black"
)
```

Wykres pudełkowy przedstawia rozkład długości terminu pożyczki. Większość wartości skupia się wokół jednej konkretnej wartości (najprawdopodobniej 360), co sugeruje, że standardowy okres pożyczki jest stały i dominujący.

Obecność licznych wartości odstających wskazuje, że w zbiorze danych znajdują się również znacznie krótsze oraz niektóre dłuższe terminy, ale występują one rzadziej. Wąski zakres międzykwartylowy (IQR) oznacza, że większość terminów pożyczek jest bardzo podobna i ma małe zróżnicowanie.

### Porównanie grup

**Wysokość pożyczki wg stanu cywilnego**

```{r}
boxplot(
  LoanAmount ~ Married,
  data = data,
  main = "Wykres pudełkowy LoanAmount względem Married",
  xlab = "Stan cywilny",
  ylab = "Kwota pożyczki",
  col = c("lightblue", "lightgreen"),
  border = "black"
)
```

Wykres pudełkowy przedstawia rozkład kwoty pożyczki (LoanAmount) w zależności od stanu cywilnego (Married). Osoby niezamężne (No) oraz zamężne (Yes) mają podobną medianę kwoty pożyczki, jednak w przypadku osób zamężnych rozkład wartości wydaje się być nieco szerszy.

Widać również większą liczbę wartości odstających (outliers) wśród osób zamężnych, co sugeruje, że niektóre osoby w tej grupie zaciągnęły znacznie wyższe pożyczki. Zakres kwot pożyczek jest zbliżony w obu grupach, jednak ogólny rozrzut danych wydaje się większy dla osób zamężnych.

**Dochód wnioskodawców wg wykształcenia**

```{r}
boxplot(
  ApplicantIncome ~ Education,
  data = data,
  main = "Wykres pudełkowy ApplicantIncome względem Education",
  xlab = "Wykształcenie",
  ylab = "Dochód wnioskodawcy",
  col = c("lightblue", "lightpink"),
  border = "black"
)
```

Wykres pudełkowy przedstawia dochód wnioskodawców (ApplicantIncome) w podziale na poziom wykształcenia (Education). Widać, że mediany dochodów dla obu grup (Graduate i Not Graduate) są zbliżone, co sugeruje, że samo ukończenie studiów nie ma znaczącego wpływu na średni poziom zarobków.

Jednak w grupie absolwentów (Graduate) występuje większa liczba wartości odstających, co oznacza, że niektórzy absolwenci osiągają znacznie wyższe dochody w porównaniu do osób bez wyższego wykształcenia. W szczególności widać kilka ekstremalnie wysokich dochodów (powyżej 60 000), które nie występują w grupie Not Graduate.

Podsumowując, chociaż średnie dochody dla obu grup są podobne, wyższe wykształcenie może zwiększać szanse na bardzo wysokie zarobki, co widoczne jest w większej liczbie wartości odstających w grupie Graduate.

**Wysokość pożyczki wg wykształcenia**

```{r}
ggplot(data, aes(x=Education,y=LoanAmount))+
  geom_boxplot() +
  labs(title="Wysokość pożyczki wg wykształcenia", x="Wykształcenie", y="Wysokość pożyczki") +
  theme_bw() + #typ kolorystyczny wykresu
  facet_wrap(~Gender) +
  coord_flip() #obraca wykres
  
```

Wykres pudełkowy przedstawia wysokość pożyczki w podziale na poziom wykształcenia oraz płeć. Widać, że zarówno absolwenci (Graduate), jak i osoby bez wyższego wykształcenia (Not Graduate) mają podobny rozkład pożyczek. Mediany dla obu grup są zbliżone, co oznacza, że poziom wykształcenia nie ma dużego wpływu na wysokość pożyczki.

Jednak zauważalne są wartości odstające, zwłaszcza wśród mężczyzn, którzy częściej otrzymują bardzo wysokie pożyczki (powyżej 300-500 tys.). Rozrzut wartości jest większy dla mężczyzn niż dla kobiet, co sugeruje, że mężczyźni mogą mieć większą różnorodność w kwotach pożyczek.

Ogólnie, poziom wykształcenia nie wydaje się znacząco wpływać na medianę pożyczki, ale widać większą liczbę ekstremalnych wartości wśród mężczyzn, co może wskazywać na inne czynniki wpływające na wysokość kredytu.

### Statystyka opisowa

W następnej części projektu przyjrzymy się statystyką opisową naszych zmiennych, a zaczniemy od podsumowania używający funkcji tbl_summary z biblioteki gtsummary. Dzięki temu szczególnie zobaczymy jak rozkładają się zmienne kategoryczne.

```{r}

dane %>% 
  select(Gender, Married, Dependents, Education, Self_Employed, 
         ApplicantIncome, CoapplicantIncome, LoanAmount, 
         Loan_Amount_Term, Credit_History, Property_Area) %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{mean} ± {sd}",    # Średnia ± odchylenie standardowe
      all_categorical() ~ "{n} ({p}%)"      # Częstość i procent dla zmiennych kategorycznych
    ),
    label = list(
      Gender ~ "Płeć",
      Married ~ "Stan cywilny",
      Dependents ~ "Osoby na utrzymaniu",
      Education ~ "Wykształcenie",
      Self_Employed ~ "Samozatrudniony",
      ApplicantIncome ~ "Dochód wnioskodawcy",
      CoapplicantIncome ~ "Dochód współwnioskodawcy",
      LoanAmount ~ "Kwota kredytu",
      Loan_Amount_Term ~ "Okres kredytowania",
      Credit_History ~ "Historia kredytowa",
      Property_Area ~ "Obszar nieruchomości"
    ),
    missing = "no" # Wyklucz braki z podsumowania
  )




```

Typowy wnioskodawca to mężczyzna (80%) z wyższym wykształceniem (77%), pozostający w związku małżeńskim (63%), bez osób na utrzymaniu (56%). Jego średni dochód wynosi 4,806 jednostek, a współwnioskodawcy 1,570 jednostek. W większości przypadków wnioskodawcy mają pozytywną historię kredytową (83%) i składają wnioski o kredyty na nieruchomości w obszarach miejskich (38%) lub półmiejskich (32%). Kwota kredytu wynosi przeciętnie 136 jednostek, a okres kredytowania to około 28,6 lat. W następnym kroku przyjrzymy się statystyką opisowym danych liczbowych.

```{r}
data %>% 
  select(ApplicantIncome, CoapplicantIncome, LoanAmount, Loan_Amount_Term) %>%
  summary()

```

Dochody głównego wnioskodawcy są znacznie wyższe od dochodów współwnioskodawców, a w wielu przypadkach współwnioskodawcy nie osiągają dochodów.Kwoty kredytów są umiarkowane, z medianą 125 jednostek, ale maksymalna kwota 550 jednostek wskazuje na obecność wnioskodawców potrzebujących znacznych środków.Typowy okres kredytowania wynosi 30 lat (360 miesięcy), co jest standardowym czasem w przypadku kredytów hipotecznych.\`\`\`
