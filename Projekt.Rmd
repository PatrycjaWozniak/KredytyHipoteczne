library(naniar)
library(dplyr)

dane <- read.csv("Hipoteczny.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)

#Utworzenie tabeli podsumowującej braki w tabeli 
miss_var_summary(dane)

#Braki są zauważalne jedynie w: Credit_History, Loan_Amount_Term, LoanAmount

#Utowrzenie tabel podsumowujących według poszczególnych kategori
dane %>%
  group_by(Married) %>%
    miss_var_summary() %>%
    print(n=22)
    
dane %>%
  group_by(Self_Employed) %>%
    miss_var_summary() %>%
    print(n=33)

dane %>%
  group_by(LoanAmount) %>%
    miss_var_summary() %>%
    print(n=10)

dane %>%
  group_by(Property_Area) %>%
    miss_var_summary() %>%
    print(n=33)
 
 dane %>%
  group_by(Gender) %>%
    miss_var_summary() %>%
    print(n=33)
    
dane %>%
  group_by(Education) %>%
    miss_var_summary() %>%
    print(n=22)

dane %>%
  group_by(CoapplicantIncome) %>%
    miss_var_summary() %>%
    print(n=10)

dane %>%
  group_by(Credit_History) %>%
    miss_var_summary() %>%
    print(n=33)
 
 
#Tabela podsumowująca brakujące wartości według wiersza    
dane %>%
  miss_case_table()
 
#Wizualizacjia brakujących danych 
vis_miss(dane)


#Wizualizacjia brakujących zmiennych, według poszczególnych wierszy
gg_miss_fct(dane, fct = Married)
gg_miss_fct(dane, fct = Self_Employed)
gg_miss_fct(dane, fct = LoanAmount)
gg_miss_fct(dane, fct = Property_Area)
  
gg_miss_fct(dane, fct = Gender)
gg_miss_fct(dane, fct = Education)
gg_miss_fct(dane, fct = CoapplicantIncome)
gg_miss_fct(dane, fct = Credit_History)  
  
  
#Wizualizacja jak często braki współwystępują między zmiennymi 
#(1 wiersz braku w Credit_History i Loan_Amount_Team)
gg_miss_upset(dane, 
              nsets = 3)
#najwięcej brakuje danych w credit history
library(VIM)
data <-hotdeck(dane)

#analiza danych odstających 
# Tworzenie histogramów
hist(
  dane$LoanAmount,
  main = "Histogram wartości LoanAmount",
  xlab = "LoanAmount",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 # Możesz dostosować liczbę przedziałów
)

hist(
  dane$ApplicantIncome,
  main = "Histogram dla ApplicantIncome",
  xlab = "Dochód wnioskodawcy",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)

hist(
  dane$CoapplicantIncome,
  main = "Histogram dla CoapplicantIncome",
  xlab = "Dochód współwnioskodawcy",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)

hist(
  dane$LoanAmount,
  main = "Histogram dla LoanAmount",
  xlab = "Kwota pożyczki",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)

hist(
  dane$Loan_Amount_Term,
  main = "Histogram dla Loan_Amount_Term",
  xlab = "Termin kwoty pożyczki",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)
hist(
  dane$Credit_History,
  main = "Histogram dla Credit_History",
  xlab = "Historia Kredytu",
  ylab = "Częstość",
  col = "lightblue",
  border = "black",
  breaks = 20 
)

#Wykresy pudełkowe dla kluczowych zmiennych
#Identyfikujemy dane odtające i porównujemy rozkłady między grupami
boxplot(
  data$LoanAmount,
  main = "Wykres pudełkowy dla LoanAmount (dane uzupełnione)",
  ylab = "Kwota pożyczki",
  col = "lightblue",
  border = "black"
)
#szukamy odstających punktów
outliers <- boxplot.stats(data$LoanAmount)$out
print(outliers)

# dane [1] wykazują duże odchylenia w stosunku do reszty danych
#czy powinnyśmy je usunąć?

boxplot(
  data$ApplicantIncome,
  main = "Wykres pudełkowy dla ApplicantIncome",
  ylab = "Dochód wnioskodawcy",
  col = "lightgreen",
  border = "black"
)

boxplot(
  data$CoapplicantIncome,
  main = "Wykres pudełkowy dla CoapplicantIncome",
  ylab = "Dochód współwnioskodawcy",
  col = "lightpink",
  border = "black"
)

boxplot(
  data$Loan_Amount_Term,
  main = "Wykres pudełkowy dla Loan_Amount_Term",
  ylab = "Termin pożyczki",
  col = "pink",
  border = "black"
)

#porównanie grup
boxplot(
  LoanAmount ~ Married,
  data = dane,
  main = "Wykres pudełkowy LoanAmount względem Married",
  xlab = "Stan cywilny",
  ylab = "Kwota pożyczki",
  col = c("lightblue", "lightgreen"),
  border = "black"
)

boxplot(
  ApplicantIncome ~ Education,
  data = dane,
  main = "Wykres pudełkowy ApplicantIncome względem Education",
  xlab = "Wykształcenie",
  ylab = "Dochód wnioskodawcy",
  col = c("lightblue", "lightpink"),
  border = "black"
)

